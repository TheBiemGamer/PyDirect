<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- Theme Toggle Icon -->
    <button class="theme-toggle" onclick="toggleTheme()">
      <i class="fas fa-moon"></i>
    </button>

    <h1>Admin Panel - Redirect Management</h1>

    <div class="nav-buttons">
      <a href="{{ url_for('settings') }}">
        <i class="fas fa-cog"></i> Settings
      </a>
      <a href="{{ url_for('logout') }}">
        <i class="fas fa-sign-out-alt"></i> Logout
      </a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %} {% for category, message in messages %}
    <div class="{{ category }}">{{ message }}</div>
    {% endfor %} {% endif %} {% endwith %}

    <div class="container">
      <form method="POST">
        <input
          type="text"
          name="source"
          placeholder="Source Path (e.g. test)"
          required
        />
        <input
          type="text"
          name="destination"
          placeholder="Destination URL (e.g. https://example.com)"
          required
        />
        <button type="submit"><i class="fas fa-plus"></i> Add Redirect</button>
      </form>
    </div>

    <table>
      <tr>
        <th>Source</th>
        <th>Destination</th>
        <th>Actions</th>
      </tr>
      {% for redirect in redirects %}
      <tr>
        <td>{{ redirect.source }}</td>
        <td>{{ redirect.destination }}</td>
        <td>
          <button class="delete-btn" data-id="{{ redirect.id }}">
            <i class="fas fa-trash"></i> Delete
          </button>
        </td>
      </tr>
      {% endfor %}
    </table>

    <script>
      document.querySelectorAll(".delete-btn").forEach((button) => {
        button.addEventListener("click", function () {
          const id = this.getAttribute("data-id");
          fetch(`/delete/${id}`, { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                location.reload();
              }
            });
        });
      });

      function toggleTheme() {
        const body = document.body;
        const icon = document.querySelector(".theme-toggle i");

        if (body.classList.contains("light-mode")) {
          body.classList.remove("light-mode");
          localStorage.setItem("theme", "dark");
          icon.classList.replace("fa-sun", "fa-moon");
        } else {
          body.classList.add("light-mode");
          localStorage.setItem("theme", "light");
          icon.classList.replace("fa-moon", "fa-sun");
        }
      }

      (function () {
        if (localStorage.getItem("theme") === "light") {
          document.body.classList.add("light-mode");
          document
            .querySelector(".theme-toggle i")
            .classList.replace("fa-moon", "fa-sun");
        }
      })();
    </script>
  </body>
</html>
